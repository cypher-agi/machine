{
  "do_token": "dop_v1_c2292e0c51bd77ed56a57305cc0406b0b3dfecf1c094df9a8d00b0b997cac3a9",
  "name": "grid-node-02",
  "region": "sfo3",
  "size": "s-1vcpu-1gb",
  "image": "ubuntu-22-04-x64",
  "tags": [],
  "user_data": "#cloud-config\npackage_update: true\npackage_upgrade: true\n\npackages:\n  - build-essential\n  - pkg-config\n  - libssl-dev\n  - libclang-dev\n  - cmake\n  - git\n  - curl\n\nusers:\n  - name: grid\n    groups: sudo\n    shell: /bin/bash\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    home: /home/grid\n\nwrite_files:\n  - path: /etc/systemd/system/the-grid.service\n    content: |\n      [Unit]\n      Description=The Grid Node\n      After=network.target\n      \n      [Service]\n      Type=simple\n      User=grid\n      WorkingDirectory=/home/grid/the-grid\n      Environment=RUST_LOG=info\n      Environment=GRID_BIND_ADDR=0.0.0.0:36900\n      ExecStart=/home/grid/the-grid/target/release/the-grid\n      Restart=always\n      RestartSec=10\n      \n      [Install]\n      WantedBy=multi-user.target\n    permissions: '0644'\n\n  - path: /home/grid/setup-grid.sh\n    content: |\n      #!/bin/bash\n      set -e\n      exec > >(tee /var/log/grid-setup.log) 2>&1\n      \n      echo \"=== $(date) - Starting Grid Setup ===\"\n      \n      # Install Rust\n      echo \"=== Installing Rust and Cargo ===\"\n      curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y\n      \n      # Source cargo environment\n      export CARGO_HOME=\"$HOME/.cargo\"\n      export RUSTUP_HOME=\"$HOME/.rustup\"\n      export PATH=\"$CARGO_HOME/bin:$PATH\"\n      source \"$HOME/.cargo/env\"\n      \n      # Verify cargo is installed\n      echo \"=== Verifying Cargo installation ===\"\n      which cargo\n      cargo --version\n      rustc --version\n      \n      # Clone the repository\n      echo \"=== Cloning the-grid repository ===\"\n      if [ -d \"/home/grid/the-grid\" ]; then\n        echo \"Directory exists, pulling latest...\"\n        cd /home/grid/the-grid\n        git pull\n      else\n        git clone https://github.com/cypher-agi/the-grid.git /home/grid/the-grid\n        cd /home/grid/the-grid\n      fi\n      \n      # Fetch all dependencies first\n      echo \"=== Fetching Cargo dependencies ===\"\n      cargo fetch\n      \n      # Build in release mode\n      echo \"=== Building the-grid (release mode) ===\"\n      cargo build --release\n      \n      # Verify binary exists\n      echo \"=== Verifying build ===\"\n      if [ -f \"target/release/the-grid\" ]; then\n        echo \"SUCCESS: Binary built at target/release/the-grid\"\n        ls -la target/release/the-grid\n      else\n        echo \"ERROR: Binary not found!\"\n        ls -la target/release/ || true\n        exit 1\n      fi\n      \n      echo \"=== $(date) - Grid Setup Complete ===\"\n    permissions: '0755'\n\nruncmd:\n  # Ensure grid user owns their home directory\n  - mkdir -p /home/grid\n  - chown -R grid:grid /home/grid\n  \n  # Run setup as grid user\n  - chown grid:grid /home/grid/setup-grid.sh\n  - su - grid -c '/home/grid/setup-grid.sh'\n  \n  # Verify binary was built before starting service\n  - |\n    if [ -f \"/home/grid/the-grid/target/release/the-grid\" ]; then\n      echo \"Binary found, starting service...\"\n      systemctl daemon-reload\n      systemctl enable the-grid.service\n      systemctl start the-grid.service\n      echo \"The Grid service started successfully\" | tee -a /var/log/grid-bootstrap.log\n    else\n      echo \"ERROR: Binary not found, service not started\" | tee -a /var/log/grid-bootstrap.log\n      exit 1\n    fi\n  \n  # Log completion\n  - echo \"The Grid bootstrap complete at $(date)\" | tee -a /var/log/grid-bootstrap.log"
}